<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="description" content="Peer-to-peer multiplayer Dots and Boxes game"> 
    <title>Dots and Boxes</title> 
    <link rel="stylesheet" href="styles/main.css"> 
    <link rel="stylesheet" href="styles/game.css"> 
    <link rel="stylesheet" href="styles/components.css"> 
</head> 
<body> 
    <!-- Menu Modal -->
    <div id="menuModal" class="modal">
        <div class="modal-content">
            <h1>Dots and Boxes</h1>
            <div class="menu-options">
                <button id="localModeBtn" class="btn btn-primary">Local Mode</button>
                <button id="onlineModeBtn" class="btn btn-primary">Online Mode</button>
            </div>
            <div class="version-identifier">v4 properPeertoPeer</div>
        </div>
    </div> 
 
    <!-- Game Setup Modal (Local Mode) -->
    <div id="gameSetupModal" class="modal hidden">
        <div class="modal-content">
            <h2>Local Game Setup</h2>

            <div class="setup-section">
                <label>Grid Size:</label>
                <select id="setupGridSize">
                    <option value="3">3x3 (4 boxes)</option>
                    <option value="5" selected>5x5 (16 boxes)</option>
                    <option value="7">7x7 (36 boxes)</option>
                </select>
            </div>

            <div class="setup-section">
                <h3>Player 1 Color</h3>
                <div class="color-picker-compact">
                    <button class="color-swatch" data-color="#C65D3B" style="background: #C65D3B;" title="Terracotta"></button>
                    <button class="color-swatch" data-color="#8B4513" style="background: #8B4513;" title="Brown"></button>
                    <button class="color-swatch" data-color="#A0522D" style="background: #A0522D;" title="Sienna"></button>
                    <button class="color-swatch" data-color="#CC8B65" style="background: #CC8B65;" title="Tan"></button>
                    <button class="color-swatch" data-color="#B87333" style="background: #B87333;" title="Copper"></button>
                    <input type="color" id="player1ColorCustom" value="#C65D3B" class="color-input-compact" title="Custom Color">
                </div>
            </div>

            <div class="setup-section">
                <h3>Player 2 Color</h3>
                <div class="color-picker-compact">
                    <button class="color-swatch" data-color="#4A6FA5" style="background: #4A6FA5;" title="Steel Blue"></button>
                    <button class="color-swatch" data-color="#2F4858" style="background: #2F4858;" title="Navy"></button>
                    <button class="color-swatch" data-color="#5B7C99" style="background: #5B7C99;" title="Slate"></button>
                    <button class="color-swatch" data-color="#556B2F" style="background: #556B2F;" title="Olive"></button>
                    <button class="color-swatch" data-color="#708090" style="background: #708090;" title="Gray"></button>
                    <input type="color" id="player2ColorCustom" value="#4A6FA5" class="color-input-compact" title="Custom Color">
                </div>
            </div>

            <div class="setup-buttons">
                <button id="startGameBtn" class="btn btn-primary">Start Game</button>
                <button id="cancelSetupBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Online Mode Setup Modal -->
    <div id="onlineSetupModal" class="modal hidden">
        <div class="modal-content">
            <h2>Online Mode</h2>
            <div class="online-options">
                <button id="hostGameBtn" class="btn btn-primary">Host Game</button>
                <div class="divider">OR</div>
                <div class="join-section">
                    <input type="text" id="roomCodeInput" placeholder="Paste Peer ID">
                    <button id="joinGameBtn" class="btn btn-primary">Join Game</button>
                </div>
            </div>
            <button id="backToMenuBtn" class="btn btn-secondary">Back</button>
        </div>
    </div>

    <!-- Host Lobby Modal -->
    <div id="hostLobbyModal" class="modal hidden">
        <div class="modal-content">
            <h2>Hosting Game</h2>

            <div class="lobby-section">
                <label>Share this Peer ID with your friend:</label>
                <div class="room-code-display">
                    <span id="hostRoomCode" class="room-code">Loading...</span>
                    <button id="copyRoomCodeBtn" class="btn btn-small">üìã Copy</button>
                </div>
            </div>

            <div class="lobby-section">
                <label>Grid Size:</label>
                <select id="hostGridSize">
                    <option value="3">3x3 (4 boxes)</option>
                    <option value="5" selected>5x5 (16 boxes)</option>
                    <option value="7">7x7 (36 boxes)</option>
                </select>
            </div>

            <div class="lobby-section">
                <h3>Your Color (Player 1)</h3>
                <div class="color-picker-compact">
                    <button class="color-swatch" data-color="#C65D3B" style="background: #C65D3B;"></button>
                    <button class="color-swatch" data-color="#8B4513" style="background: #8B4513;"></button>
                    <button class="color-swatch" data-color="#A0522D" style="background: #A0522D;"></button>
                    <button class="color-swatch" data-color="#CC8B65" style="background: #CC8B65;"></button>
                    <button class="color-swatch" data-color="#B87333" style="background: #B87333;"></button>
                    <input type="color" id="hostColorCustom" value="#C65D3B" class="color-input-compact">
                </div>
            </div>

            <div class="lobby-section">
                <h3>Opponent Color (Player 2)</h3>
                <div class="opponent-color-preview">
                    <div class="color-preview-box" id="hostOpponentColorPreview" style="background: #4A6FA5;"></div>
                    <span id="hostOpponentColorLabel">Waiting for opponent...</span>
                </div>
            </div>

            <div class="lobby-section">
                <div class="connection-status" id="hostConnectionStatus">
                    <span class="status-text">Waiting for opponent...</span>
                </div>
            </div>

            <div class="lobby-buttons">
                <button id="startOnlineGameBtn" class="btn btn-primary" disabled>Start Game</button>
                <button id="cancelHostBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Guest Lobby Modal -->
    <div id="guestLobbyModal" class="modal hidden">
        <div class="modal-content">
            <h2>Joined Game</h2>

            <div class="lobby-section">
                <h3>Your Color (Player 2)</h3>
                <div class="color-picker-compact">
                    <button class="color-swatch" data-color="#4A6FA5" style="background: #4A6FA5;"></button>
                    <button class="color-swatch" data-color="#2F4858" style="background: #2F4858;"></button>
                    <button class="color-swatch" data-color="#5B7C99" style="background: #5B7C99;"></button>
                    <button class="color-swatch" data-color="#556B2F" style="background: #556B2F;"></button>
                    <button class="color-swatch" data-color="#708090" style="background: #708090;"></button>
                    <input type="color" id="guestColorCustom" value="#4A6FA5" class="color-input-compact">
                </div>
            </div>

            <div class="lobby-section">
                <h3>Host Color (Player 1)</h3>
                <div class="opponent-color-preview">
                    <div class="color-preview-box" id="guestHostColorPreview" style="background: #C65D3B;"></div>
                    <span id="guestHostColorLabel">Host's color</span>
                </div>
            </div>

            <div class="lobby-section">
                <div class="connection-status">
                    <span class="status-text">Waiting for host to start...</span>
                </div>
            </div>

            <div class="lobby-buttons">
                <button id="leaveGameBtn" class="btn btn-secondary">Leave Game</button>
            </div>
        </div>
    </div>

    <!-- Color Settings Modal (Mid-game) -->
    <div id="colorSettingsModal" class="modal hidden">
        <div class="modal-content">
            <h2>Change Colors</h2>

            <div class="setup-section">
                <h3>Player 1 Color</h3>
                <div class="color-picker-compact" id="settingsPlayer1Presets">
                    <button class="color-swatch" data-color="#C65D3B" style="background: #C65D3B;"></button>
                    <button class="color-swatch" data-color="#8B4513" style="background: #8B4513;"></button>
                    <button class="color-swatch" data-color="#A0522D" style="background: #A0522D;"></button>
                    <button class="color-swatch" data-color="#CC8B65" style="background: #CC8B65;"></button>
                    <button class="color-swatch" data-color="#B87333" style="background: #B87333;"></button>
                    <input type="color" id="settingsPlayer1Custom" class="color-input-compact" title="Custom Color">
                </div>
            </div>

            <div class="setup-section">
                <h3>Player 2 Color</h3>
                <div class="color-picker-compact" id="settingsPlayer2Presets">
                    <button class="color-swatch" data-color="#4A6FA5" style="background: #4A6FA5;"></button>
                    <button class="color-swatch" data-color="#2F4858" style="background: #2F4858;"></button>
                    <button class="color-swatch" data-color="#5B7C99" style="background: #5B7C99;"></button>
                    <button class="color-swatch" data-color="#556B2F" style="background: #556B2F;"></button>
                    <button class="color-swatch" data-color="#708090" style="background: #708090;"></button>
                    <input type="color" id="settingsPlayer2Custom" class="color-input-compact" title="Custom Color">
                </div>
            </div>

            <div class="setup-buttons">
                <button id="applyColorsBtn" class="btn btn-primary">Apply</button>
                <button id="closeSettingsBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div> 
 
    <!-- Game Area -->
    <div id="gameArea" class="hidden">
        <div id="gameInfo">
            <div id="roomCodeDisplay" class="hidden"></div>

            <!-- Turn Indicator with Glow -->
            <div id="turnIndicator" class="turn-indicator">
                <div class="player-turn-info">
                    <div class="player-indicator" id="player1Indicator">
                        <div class="color-dot" id="player1Dot"></div>
                        <span>P1</span>
                    </div>
                    <div class="player-indicator" id="player2Indicator">
                        <div class="color-dot" id="player2Dot"></div>
                        <span>P2</span>
                    </div>
                </div>
                <div class="turn-text" id="turnText">Player 1's Turn</div>
            </div>

            <!-- Score Display -->
            <div id="scoreDisplay" class="score-display">
                <div class="player-score">
                    <span class="score-label">P1:</span>
                    <span class="score-value" id="player1Score">0</span>
                </div>
                <div class="score-divider">|</div>
                <div class="player-score">
                    <span class="score-label">P2:</span>
                    <span class="score-value" id="player2Score">0</span>
                </div>
            </div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div id="gameControls">
            <button id="settingsBtn" class="btn btn-secondary">‚öôÔ∏è Colors</button>
            <button id="quitGameBtn" class="btn btn-secondary">Quit Game</button>
        </div>
    </div> 
 
    <!-- Game Over Modal --> 
    <div id="gameOverModal" class="modal hidden"> 
        <div class="modal-content"> 
            <h2>Game Over!</h2> 
            <div id="winnerText"></div> 
            <div id="statsDisplay"></div> 
            <div class="game-over-buttons"> 
                <button id="restartBtn" class="btn btn-primary">Play Again</button> 
                <button id="mainMenuBtn" class="btn btn-secondary">Main Menu</button> 
            </div> 
        </div> 
    </div> 
 
    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="loading-indicator hidden">
        <p id="loadingText">Connecting<span class="loading-dots"></span></p>
    </div>

    <!-- Error Toast -->
    <div id="errorToast" class="toast hidden"></div>

    <!-- Mobile Debug Console (Eruda) - Remove this section after debugging -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>
        // Auto-init Eruda on mobile devices or when ?debug=true in URL
        if (/Mobile|Android|iPhone|iPad/i.test(navigator.userAgent) || window.location.search.includes('debug=true')) {
            eruda.init();
            console.log('üì± Mobile console enabled - Click the floating button to view logs');
        }
    </script>

    <!-- PeerJS Library -->
    <script src="https://unpkg.com/peerjs@1.5.0/dist/peerjs.min.js"></script>

    <!-- Game Scripts -->
    <script type="module" src="scripts/main.js"></script> 
</body> 
</html> 
